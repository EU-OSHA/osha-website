<?php
/**
 * @file
 * Code for the osha_wiki feature.
 */

include_once 'osha_wiki.features.inc';

define('OSHA_WIKI_CONTENT_TYPE', 'wiki_page');

/**
 * Define custom view mode for entities - wiki
 */
function osha_wiki_entity_info_alter(&$entity_info) {
  $entity_info['node']['view modes']['osha_wiki'] = array(
    'label' => t('OSH Wiki'),
    'custom settings' => TRUE,
  );
}

/* *
 * Implements hook_block_list_alter() to hide the related wiki under publication
 * when manual wiki articles have been linked to the current publication
 */

function osha_wiki_block_list_alter(&$blocks) {
    $node = menu_get_object();
    if ($node && !empty($node->field_related_oshwiki_articles[LANGUAGE_NONE][0])) {
        foreach ($blocks as $block_id => $block) {
            if ($block->delta == 'related_content-block_5') {
                unset ($blocks[$block_id]);
                break;
            }
        }
    }
}
